<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>examples/main.cpp</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body onload='searchBox.OnSelectItem(0);'>
<!-- Generated by Doxygen 1.7.4 -->
<script type="text/javascript"><!--
var searchBox = new SearchBox("searchBox", "search",false,'Search');
--></script>
<div id="top">
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="logo.png"/></td>
 </tr>
 </tbody>
</table>
</div>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
      <li id="searchli">
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="headertitle">
<div class="title">examples/main.cpp</div>  </div>
</div>
<div class="contents">
<p>Neal's "funnel" distribution and logistic regression.</p>
<div class="fragment"><pre class="fragment"><span class="preprocessor">#include &lt;iostream&gt;</span>
<span class="preprocessor">#include &lt;fstream&gt;</span>
<span class="preprocessor">#include &lt;time.h&gt;</span>

<span class="preprocessor">#include &lt;RandomLib/Random.hpp&gt;</span>
<span class="preprocessor">#include &lt;RandomLib/NormalDistribution.hpp&gt;</span>

<span class="preprocessor">#include &quot;flatFunnel.h&quot;</span>
<span class="preprocessor">#include &quot;softAbsFunnel.h&quot;</span>
<span class="preprocessor">#include &quot;fisherBayesLogReg.h&quot;</span>
<span class="preprocessor">#include &quot;softAbsBayesLogReg.h&quot;</span>

<span class="preprocessor">#include &quot;chainBundle.hpp&quot;</span>

<span class="keyword">using namespace </span>std;

<span class="keywordtype">int</span> main (<span class="keywordtype">int</span> argc, <span class="keyword">const</span> <span class="keywordtype">char</span> * argv[])
{
    
    <span class="comment">/************************************************/</span>
    <span class="comment">/*                                              */</span>
    <span class="comment">/*                 Preliminaries                */</span>
    <span class="comment">/*                                              */</span>
    <span class="comment">/************************************************/</span>
    
    clock_t start;
    clock_t end;
    <span class="keywordtype">double</span> deltaT;
    
    RandomLib::Random random;
    random.Reseed();
    
    std::ofstream trajectory;
    std::ofstream stats;
    
    <span class="comment">/************************************************/</span>
    <span class="comment">/*                                              */</span>
    <span class="comment">/*                    Funnel                    */</span>
    <span class="comment">/*                                              */</span>
    <span class="comment">/************************************************/</span>
    
    <span class="keywordtype">int</span> funnelDim = 50;
    
    VectorXd funnelInitChain(funnelDim + 1);
    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 0; i &lt; funnelDim + 1; ++i) funnelInitChain(i) = 2 * random.FloatU&lt;<span class="keywordtype">double</span>&gt;() - 1;
    
    VectorXd funnelInitTrajectory(funnelDim + 1);
    funnelInitTrajectory(0) = 3.5;
    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 1; i &lt; funnelDim + 1; ++i) funnelInitTrajectory(i) = 10 * random.FloatU&lt;<span class="keywordtype">double</span>&gt;() - 5;
    
    <span class="comment">/************************************************/</span>
    <span class="comment">/*                  Euclidean HMC               */</span>
    <span class="comment">/************************************************/</span>
    
    cout &lt;&lt; <span class="stringliteral">&quot;Beginning Flat Funnel...&quot;</span> &lt;&lt; endl;
    
    <a name="_a0"></a><a class="code" href="classchain_bundle.html">chainBundle&lt;flatFunnel&gt;</a> flatFunnelBundle(random);
    flatFunnelBundle.<a name="a1"></a><a class="code" href="classchain_bundle.html#a4f1f4ce7d120254ea37dcd2009f4f4a7" title="Set reject/accept window size.">setWindowSize</a>(0);
    flatFunnelBundle.<a name="a2"></a><a class="code" href="classchain_bundle.html#aab0f4b4d5d5b0a0fd79d7898c3cd187e" title="Set maximum calculated lag.">setMaxLagCalc</a>(1000);
    flatFunnelBundle.<a name="a3"></a><a class="code" href="classchain_bundle.html#ad8dd855dcf3f96e996f7443de4e32ec1" title="Set maximum displayed lag.">setMaxLagDisplay</a>(1000);
    
    flatFunnelBundle.<a name="a4"></a><a class="code" href="classchain_bundle.html#a01efcad844680e9a5b2c82b135e801e3" title="Add a new chain to the bundle.">addChain</a>(<span class="keyword">new</span> <a name="_a5"></a><a class="code" href="classflat_funnel.html">flatFunnel</a>(funnelDim));
    
    <span class="comment">// Generate and then save a Hamiltonian trajectory</span>
    <span class="comment">// Display the trajectory with `./plotTrajectory flatFunnelTrajectory.txt` </span>
    flatFunnelBundle.<a name="a6"></a><a class="code" href="classchain_bundle.html#a451a3c3df477013de63223ead7137f7b" title="Set stepsize.">setStepSize</a>(1e-2);
    flatFunnelBundle.<a name="a7"></a><a class="code" href="classchain_bundle.html#aa54b5be69cca466fdf5c46b135eaf460" title="Set number of leapfrog steps.">setNumLeapfrog</a>(5000);
    
    flatFunnelBundle.<a name="a8"></a><a class="code" href="classchain_bundle.html#a116c4299238c3a17a82e24217225a1df" title="Return pointer to ith chain.">chain</a>(0)-&gt;<a name="a9"></a><a class="code" href="classbase_hamiltonian.html#ac1c8948cf4ae590a10d62e45e5a8a337" title="Return the current position.">q</a>() = funnelInitTrajectory;
    flatFunnelBundle.<a class="code" href="classchain_bundle.html#a116c4299238c3a17a82e24217225a1df" title="Return pointer to ith chain.">chain</a>(0)-&gt;<a name="a10"></a><a class="code" href="classdiag_const_metric.html#a9a9210437e5b2c3bd98978928cad8a6f">sampleP</a>(random);
    flatFunnelBundle.<a class="code" href="classchain_bundle.html#a116c4299238c3a17a82e24217225a1df" title="Return pointer to ith chain.">chain</a>(0)-&gt;<a name="a11"></a><a class="code" href="classbase_hamiltonian.html#aa84e4d0258627ab9069395d8ba48fd96">prepareEvolution</a>();
    
    trajectory.open(<span class="stringliteral">&quot;flatFunnelTrajectory.txt&quot;</span>);
    flatFunnelBundle.<a name="a12"></a><a class="code" href="classchain_bundle.html#a53025b5e33718f2fcadbcb2e25c468da">saveTrajectory</a>(trajectory);
    trajectory.close();
    
    <span class="comment">// Generate samples from the distribution</span>
    <span class="comment">// Note that no step-size adaption is used</span>
    <span class="comment">// Trace plots can be genereated with `./plotTrace flatFunnelStats.txt` </span>
    flatFunnelBundle.<a name="a13"></a><a class="code" href="classchain_bundle.html#ae88d42fe20e5092cce162773bb1a4070" title="Clear all stored samples.">clearSamples</a>();
    flatFunnelBundle.<a class="code" href="classchain_bundle.html#a451a3c3df477013de63223ead7137f7b" title="Set stepsize.">setStepSize</a>(1e-2);
    
    flatFunnelBundle.<a class="code" href="classchain_bundle.html#a116c4299238c3a17a82e24217225a1df" title="Return pointer to ith chain.">chain</a>(0)-&gt;<a class="code" href="classbase_hamiltonian.html#ac1c8948cf4ae590a10d62e45e5a8a337" title="Return the current position.">q</a>() = funnelInitChain;
    flatFunnelBundle.<a class="code" href="classchain_bundle.html#a116c4299238c3a17a82e24217225a1df" title="Return pointer to ith chain.">chain</a>(0)-&gt;<a class="code" href="classdiag_const_metric.html#a9a9210437e5b2c3bd98978928cad8a6f">sampleP</a>(random);
    flatFunnelBundle.<a class="code" href="classchain_bundle.html#a116c4299238c3a17a82e24217225a1df" title="Return pointer to ith chain.">chain</a>(0)-&gt;<a class="code" href="classbase_hamiltonian.html#aa84e4d0258627ab9069395d8ba48fd96">prepareEvolution</a>();
    
    flatFunnelBundle.<a name="a14"></a><a class="code" href="classchain_bundle.html#a4731dfa8145b244fd43a82a79e87b9c0" title="Set target integration time for stepsize adaptation.">setAdaptIntTime</a>(15.0);
    flatFunnelBundle.<a name="a15"></a><a class="code" href="classchain_bundle.html#a905a02bac8c26e688448feadd1e5eda2">initAdaptation</a>();
    
    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 0; i &lt; 1000; ++i) 
    {
        <span class="keywordflow">if</span>(i % 10 == 0) cout &lt;&lt; <span class="stringliteral">&quot;.&quot;</span> &lt;&lt; flush;
        flatFunnelBundle.<a name="a16"></a><a class="code" href="classchain_bundle.html#afcb8998fd1403bd9098995d478bf3818" title="Transition all chains currently in the bundle.">transition</a>(0);
    }
    cout &lt;&lt; endl;
    
    cout &lt;&lt; <span class="stringliteral">&quot;Accept probability after burn = &quot;</span> &lt;&lt; flatFunnelBundle.<a class="code" href="classchain_bundle.html#a116c4299238c3a17a82e24217225a1df" title="Return pointer to ith chain.">chain</a>(0)-&gt;<a name="a17"></a><a class="code" href="classbase_hamiltonian.html#ad42f44cca58f1b25ee6fd8ff68c79c57" title="Metropolis accept rate over the history of the chains.">acceptRate</a>() &lt;&lt; endl;
    
    flatFunnelBundle.<a class="code" href="classchain_bundle.html#ae88d42fe20e5092cce162773bb1a4070" title="Clear all stored samples.">clearSamples</a>();
    
    start = clock();
    
    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 0; i &lt; 10000; ++i) 
    {
        <span class="keywordflow">if</span>(i % 100 == 0) cout &lt;&lt; <span class="stringliteral">&quot;.&quot;</span> &lt;&lt; flush;
        flatFunnelBundle.<a class="code" href="classchain_bundle.html#afcb8998fd1403bd9098995d478bf3818" title="Transition all chains currently in the bundle.">transition</a>(0);
    }
    cout &lt;&lt; endl;
    
    end = clock();
    
    deltaT = (double)(end - start) / CLOCKS_PER_SEC;
    
    cout &lt;&lt; <span class="stringliteral">&quot;Accept probability after sampling = &quot;</span> &lt;&lt; flatFunnelBundle.<a class="code" href="classchain_bundle.html#a116c4299238c3a17a82e24217225a1df" title="Return pointer to ith chain.">chain</a>(0)-&gt;<a class="code" href="classbase_hamiltonian.html#ad42f44cca58f1b25ee6fd8ff68c79c57" title="Metropolis accept rate over the history of the chains.">acceptRate</a>() &lt;&lt; endl;
    
    stats.open(<span class="stringliteral">&quot;flatFunnelStats.txt&quot;</span>);
    flatFunnelBundle.<a name="a18"></a><a class="code" href="classchain_bundle.html#aa828a38cc56f0cc47f6fbd177be5ee2a">computeSummaryStats</a>(1, <span class="keyword">false</span>, &amp;stats);
    stats.close();
    
    cout &lt;&lt; <span class="stringliteral">&quot;Flat Funnel (No adaptation):&quot;</span> &lt;&lt; endl;
    cout &lt;&lt; <span class="stringliteral">&quot;\tDeltaT = &quot;</span> &lt;&lt; deltaT &lt;&lt; <span class="stringliteral">&quot; seconds&quot;</span> &lt;&lt; endl;
    cout &lt;&lt; <span class="stringliteral">&quot;\tminESS = &quot;</span> &lt;&lt; flatFunnelBundle.<a name="a19"></a><a class="code" href="classchain_bundle.html#ad64d47d0f4803ce73c4ef52c5732b050" title="Return the smallest effective sample size.">minESS</a>() &lt;&lt; endl;
    cout &lt;&lt; <span class="stringliteral">&quot;\tminESS / DeltaT = &quot;</span> &lt;&lt; flatFunnelBundle.<a class="code" href="classchain_bundle.html#ad64d47d0f4803ce73c4ef52c5732b050" title="Return the smallest effective sample size.">minESS</a>() / deltaT &lt;&lt; <span class="stringliteral">&quot; s^{-1}&quot;</span> &lt;&lt; endl;
    cout &lt;&lt; endl;
    
    <span class="comment">/************************************************/</span>
    <span class="comment">/*                 Riemannian HMC               */</span>
    <span class="comment">/*            with the SoftAbs Metric           */</span>
    <span class="comment">/************************************************/</span>
    
    cout &lt;&lt; <span class="stringliteral">&quot;Beginning SoftAbs Funnel...&quot;</span> &lt;&lt; endl;
    
    <a class="code" href="classchain_bundle.html">chainBundle&lt;softAbsFunnel&gt;</a> softAbsFunnelBundle(random);
    softAbsFunnelBundle.<a name="a20"></a><a class="code" href="classchain_bundle.html#a4f1f4ce7d120254ea37dcd2009f4f4a7" title="Set reject/accept window size.">setWindowSize</a>(0);
    softAbsFunnelBundle.<a name="a21"></a><a class="code" href="classchain_bundle.html#aab0f4b4d5d5b0a0fd79d7898c3cd187e" title="Set maximum calculated lag.">setMaxLagCalc</a>(50);
    softAbsFunnelBundle.<a name="a22"></a><a class="code" href="classchain_bundle.html#ad8dd855dcf3f96e996f7443de4e32ec1" title="Set maximum displayed lag.">setMaxLagDisplay</a>(50);
    
    softAbsFunnelBundle.<a name="a23"></a><a class="code" href="classchain_bundle.html#a01efcad844680e9a5b2c82b135e801e3" title="Add a new chain to the bundle.">addChain</a>(<span class="keyword">new</span> <a name="_a24"></a><a class="code" href="classsoft_abs_funnel.html">softAbsFunnel</a>(funnelDim));
    
    <span class="comment">// Generate and then save a Hamiltonian trajectory</span>
    <span class="comment">// Display the trajectory with `./plotTrajectory softAbsFunnelTrajectory.txt` </span>
    softAbsFunnelBundle.<a name="a25"></a><a class="code" href="classchain_bundle.html#a451a3c3df477013de63223ead7137f7b" title="Set stepsize.">setStepSize</a>(1e-2);
    softAbsFunnelBundle.<a name="a26"></a><a class="code" href="classchain_bundle.html#aa54b5be69cca466fdf5c46b135eaf460" title="Set number of leapfrog steps.">setNumLeapfrog</a>(5000);
    
    <a class="code" href="classsoft_abs_funnel.html">softAbsFunnel</a>* chain = (<a class="code" href="classsoft_abs_funnel.html">softAbsFunnel</a>*)softAbsFunnelBundle.<a name="a27"></a><a class="code" href="classchain_bundle.html#a116c4299238c3a17a82e24217225a1df" title="Return pointer to ith chain.">chain</a>(0);
    chain-&gt;<a name="a28"></a><a class="code" href="classsoft_abs_metric.html#a1d59676a1548ad7723aaa6ea0149e652" title="Set the SoftAbs regularization coefficient.">setSoftAbsAlpha</a>(1e6);
    
    chain-&gt;<a class="code" href="classbase_hamiltonian.html#ac1c8948cf4ae590a10d62e45e5a8a337" title="Return the current position.">q</a>() = funnelInitTrajectory;
    chain-&gt;<a name="a29"></a><a class="code" href="classsoft_abs_metric.html#a4d2530ca42c2984eba797982d26d54b3">sampleP</a>(random);
    chain-&gt;<a name="a30"></a><a class="code" href="classdynam_metric.html#a3f60a5d4db2b1c1cf0a9f69d503c3e02">prepareEvolution</a>();
    
    trajectory.open(<span class="stringliteral">&quot;softAbsFunnelTrajectory.txt&quot;</span>);
    softAbsFunnelBundle.<a name="a31"></a><a class="code" href="classchain_bundle.html#a53025b5e33718f2fcadbcb2e25c468da">saveTrajectory</a>(trajectory);
    trajectory.close();
    
    <span class="comment">// Generate samples from the distribution</span>
    <span class="comment">// Note that step-size adaption is used</span>
    <span class="comment">// Trace plots can be genereated with `./plotTrace softAbsFunnelStats.txt` </span>
    softAbsFunnelBundle.<a name="a32"></a><a class="code" href="classchain_bundle.html#ae88d42fe20e5092cce162773bb1a4070" title="Clear all stored samples.">clearSamples</a>();
    softAbsFunnelBundle.<a class="code" href="classchain_bundle.html#a451a3c3df477013de63223ead7137f7b" title="Set stepsize.">setStepSize</a>(1e-1);
    
    softAbsFunnelBundle.<a class="code" href="classchain_bundle.html#a116c4299238c3a17a82e24217225a1df" title="Return pointer to ith chain.">chain</a>(0)-&gt;<a class="code" href="classbase_hamiltonian.html#ac1c8948cf4ae590a10d62e45e5a8a337" title="Return the current position.">q</a>() = funnelInitChain;
    softAbsFunnelBundle.<a class="code" href="classchain_bundle.html#a116c4299238c3a17a82e24217225a1df" title="Return pointer to ith chain.">chain</a>(0)-&gt;<a class="code" href="classsoft_abs_metric.html#a4d2530ca42c2984eba797982d26d54b3">sampleP</a>(random);
    softAbsFunnelBundle.<a class="code" href="classchain_bundle.html#a116c4299238c3a17a82e24217225a1df" title="Return pointer to ith chain.">chain</a>(0)-&gt;<a class="code" href="classdynam_metric.html#a3f60a5d4db2b1c1cf0a9f69d503c3e02">prepareEvolution</a>();
    
    softAbsFunnelBundle.<a name="a33"></a><a class="code" href="classchain_bundle.html#a4731dfa8145b244fd43a82a79e87b9c0" title="Set target integration time for stepsize adaptation.">setAdaptIntTime</a>(15.0);
    softAbsFunnelBundle.<a name="a34"></a><a class="code" href="classchain_bundle.html#a363544defaffd2ff9c3ca00d9d8e663d" title="Set target accept rate for stepsize adaptation.">setAdaptTargetAccept</a>(0.95);
    softAbsFunnelBundle.<a name="a35"></a><a class="code" href="classchain_bundle.html#a905a02bac8c26e688448feadd1e5eda2">initAdaptation</a>();
    softAbsFunnelBundle.<a name="a36"></a><a class="code" href="classchain_bundle.html#aab7aca03b4e6281d15a7b352b2cb2255" title="Engage dual-averaging stepsize adaptation.">engageAdaptation</a>();
    
    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 0; i &lt; 100; ++i) 
    {
        <span class="keywordflow">if</span>(i % 10 == 0) cout &lt;&lt; <span class="stringliteral">&quot;.&quot;</span> &lt;&lt; flush;
        softAbsFunnelBundle.<a name="a37"></a><a class="code" href="classchain_bundle.html#afcb8998fd1403bd9098995d478bf3818" title="Transition all chains currently in the bundle.">transition</a>(0);
    }
    cout &lt;&lt; endl;
    
    cout &lt;&lt; <span class="stringliteral">&quot;Accept probability after burn = &quot;</span> &lt;&lt; softAbsFunnelBundle.<a class="code" href="classchain_bundle.html#a116c4299238c3a17a82e24217225a1df" title="Return pointer to ith chain.">chain</a>(0)-&gt;<a class="code" href="classbase_hamiltonian.html#ad42f44cca58f1b25ee6fd8ff68c79c57" title="Metropolis accept rate over the history of the chains.">acceptRate</a>() &lt;&lt; endl;
    cout &lt;&lt; <span class="stringliteral">&quot;Stepsize = &quot;</span> &lt;&lt; softAbsFunnelBundle.<a name="a38"></a><a class="code" href="classchain_bundle.html#a78103c7106191e7764763e5eef6d8f40" title="Return current stepsize.">stepSize</a>() &lt;&lt; <span class="stringliteral">&quot;, nLeapfrog = &quot;</span> &lt;&lt; softAbsFunnelBundle.<a name="a39"></a><a class="code" href="classchain_bundle.html#a54f9f8c8f2ef2b989f190f7fe995e37b" title="Return current number of leapfrog steps.">nLeapfrog</a>() &lt;&lt; endl;
    
    softAbsFunnelBundle.<a name="a40"></a><a class="code" href="classchain_bundle.html#adeeb43f183d04c955ce1f1b496a32497" title="Disengage dual-averaging stepsize adaptation.">disengageAdaptation</a>();
    softAbsFunnelBundle.<a class="code" href="classchain_bundle.html#ae88d42fe20e5092cce162773bb1a4070" title="Clear all stored samples.">clearSamples</a>();
    
    start = clock();
    
    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 0; i &lt; 1000; ++i) 
    {
        <span class="keywordflow">if</span>(i % 10 == 0) cout &lt;&lt; <span class="stringliteral">&quot;.&quot;</span> &lt;&lt; flush;
        softAbsFunnelBundle.<a class="code" href="classchain_bundle.html#afcb8998fd1403bd9098995d478bf3818" title="Transition all chains currently in the bundle.">transition</a>(0);
    }
    cout &lt;&lt; endl;
    
    end = clock();
    
    deltaT = (double)(end - start) / CLOCKS_PER_SEC;
    
    cout &lt;&lt; <span class="stringliteral">&quot;Accept probability after sampling = &quot;</span> &lt;&lt; softAbsFunnelBundle.<a class="code" href="classchain_bundle.html#a116c4299238c3a17a82e24217225a1df" title="Return pointer to ith chain.">chain</a>(0)-&gt;<a class="code" href="classbase_hamiltonian.html#ad42f44cca58f1b25ee6fd8ff68c79c57" title="Metropolis accept rate over the history of the chains.">acceptRate</a>() &lt;&lt; endl;
    
    stats.open(<span class="stringliteral">&quot;softAbsFunnelStats.txt&quot;</span>);
    softAbsFunnelBundle.<a name="a41"></a><a class="code" href="classchain_bundle.html#aa828a38cc56f0cc47f6fbd177be5ee2a">computeSummaryStats</a>(1, <span class="keyword">false</span>, &amp;stats);
    stats.close();
    
    cout &lt;&lt; <span class="stringliteral">&quot;SoftAbs Funnel:&quot;</span> &lt;&lt; endl;
    cout &lt;&lt; <span class="stringliteral">&quot;\tDeltaT = &quot;</span> &lt;&lt; deltaT &lt;&lt; <span class="stringliteral">&quot; seconds&quot;</span> &lt;&lt; endl;
    cout &lt;&lt; <span class="stringliteral">&quot;\tminESS = &quot;</span> &lt;&lt; softAbsFunnelBundle.<a name="a42"></a><a class="code" href="classchain_bundle.html#ad64d47d0f4803ce73c4ef52c5732b050" title="Return the smallest effective sample size.">minESS</a>() &lt;&lt; endl;
    cout &lt;&lt; <span class="stringliteral">&quot;\tminESS / DeltaT = &quot;</span> &lt;&lt; softAbsFunnelBundle.<a class="code" href="classchain_bundle.html#ad64d47d0f4803ce73c4ef52c5732b050" title="Return the smallest effective sample size.">minESS</a>() / deltaT &lt;&lt; <span class="stringliteral">&quot; s^{-1}&quot;</span> &lt;&lt; endl;
    cout &lt;&lt; endl;
    
    <span class="comment">/************************************************/</span>
    <span class="comment">/*                                              */</span>
    <span class="comment">/*             Logistic Regression              */</span>
    <span class="comment">/*                                              */</span>
    <span class="comment">/************************************************/</span>
    
    <span class="keywordtype">int</span> nData = 768;
    <span class="keywordtype">int</span> nCovar = 8;
    
    MatrixXd data = MatrixXd::Zero(nData, nCovar + 1);
    VectorXd t = VectorXd::Zero(nData);
    
    <span class="keywordtype">double</span> alpha = 100.0;
    
    <span class="comment">// Input data (http://archive.ics.uci.edu/ml/datasets/Pima+Indians+Diabetes)</span>
    <span class="comment">// Note that the data has not been standarized</span>
    
    ifstream inputData;
    inputData.open(<span class="stringliteral">&quot;pima-indians-diabetes.space.dat&quot;</span>);
    
    <span class="keywordtype">double</span> buffer = 0.0;
    
    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> n = 0; n &lt; nData; ++n)
    {
        
        <span class="comment">// Covariates</span>
        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 0; i &lt; nCovar; ++i)
        {
            inputData &gt;&gt; buffer;
            data(n, i) = buffer;
        }
        
        <span class="comment">// Intercept</span>
        data(n, nCovar) = 1;
        
        <span class="comment">// Predictor</span>
        inputData &gt;&gt; buffer;
        t(n) = buffer;
        
    }
    
    inputData.close();
    
    <span class="comment">// Sampling preliminaries</span>
    VectorXd initQ(nCovar + 1);
    initQ(0) = 0.101596;
    initQ(1) = 0.0136317;
    initQ(2) = -0.0194615;
    initQ(3) = 0.00527742;
    initQ(4) = 0.00143356;
    initQ(5) = -0.0304068;
    initQ(6) = -0.496651;
    initQ(7) = -0.0128637;
    initQ(8) = 0.0574961;
    
    <span class="keywordtype">int</span> nBurn = 100;
    <span class="keywordtype">int</span> nSample = 1000;
    
    <span class="keywordtype">int</span> nLagCalc = 100;
    <span class="keywordtype">int</span> nLagDisplay = 100;
    
    <span class="comment">/************************************************/</span>
    <span class="comment">/*                 Riemannian HMC               */</span>
    <span class="comment">/*           with the Fisher-Rao Metric         */</span>
    <span class="comment">/************************************************/</span>
    
    cout &lt;&lt; <span class="stringliteral">&quot;Beginning Fisher-Rao Logistic Regression...&quot;</span> &lt;&lt; endl;
    
    <a class="code" href="classchain_bundle.html">chainBundle&lt;fisherBayesLogReg&gt;</a> fisherLogRegBundle(random);
    fisherLogRegBundle.<a name="a43"></a><a class="code" href="classchain_bundle.html#a4f1f4ce7d120254ea37dcd2009f4f4a7" title="Set reject/accept window size.">setWindowSize</a>(0);
    fisherLogRegBundle.<a name="a44"></a><a class="code" href="classchain_bundle.html#aab0f4b4d5d5b0a0fd79d7898c3cd187e" title="Set maximum calculated lag.">setMaxLagCalc</a>(nLagCalc);
    fisherLogRegBundle.<a name="a45"></a><a class="code" href="classchain_bundle.html#ad8dd855dcf3f96e996f7443de4e32ec1" title="Set maximum displayed lag.">setMaxLagDisplay</a>(nLagDisplay);
    
    fisherLogRegBundle.<a name="a46"></a><a class="code" href="classchain_bundle.html#a01efcad844680e9a5b2c82b135e801e3" title="Add a new chain to the bundle.">addChain</a>(<span class="keyword">new</span> <a name="_a47"></a><a class="code" href="classfisher_bayes_log_reg.html">fisherBayesLogReg</a>(data, t, alpha));
    
    fisherLogRegBundle.<a name="a48"></a><a class="code" href="classchain_bundle.html#a451a3c3df477013de63223ead7137f7b" title="Set stepsize.">setStepSize</a>(1e-2);
    
    fisherLogRegBundle.<a name="a49"></a><a class="code" href="classchain_bundle.html#a116c4299238c3a17a82e24217225a1df" title="Return pointer to ith chain.">chain</a>(0)-&gt;<a class="code" href="classbase_hamiltonian.html#ac1c8948cf4ae590a10d62e45e5a8a337" title="Return the current position.">q</a>() = initQ;
    fisherLogRegBundle.<a class="code" href="classchain_bundle.html#a116c4299238c3a17a82e24217225a1df" title="Return pointer to ith chain.">chain</a>(0)-&gt;<a name="a50"></a><a class="code" href="classdense_fisher_metric.html#a0c4e917fe90a9d601a74fdcbe76ff63b">sampleP</a>(random);
    fisherLogRegBundle.<a class="code" href="classchain_bundle.html#a116c4299238c3a17a82e24217225a1df" title="Return pointer to ith chain.">chain</a>(0)-&gt;<a name="a51"></a><a class="code" href="classdense_fisher_metric.html#a0ddc8c750c29c808f4bd613c00c11a2b">prepareEvolution</a>();
    
    fisherLogRegBundle.<a name="a52"></a><a class="code" href="classchain_bundle.html#a4731dfa8145b244fd43a82a79e87b9c0" title="Set target integration time for stepsize adaptation.">setAdaptIntTime</a>(1.5);
    fisherLogRegBundle.<a name="a53"></a><a class="code" href="classchain_bundle.html#a363544defaffd2ff9c3ca00d9d8e663d" title="Set target accept rate for stepsize adaptation.">setAdaptTargetAccept</a>(0.35);
    fisherLogRegBundle.<a name="a54"></a><a class="code" href="classchain_bundle.html#ae8f5c21a7ced7410daac06eb2c6202c2" title="Set maximum number of leapfrog steps for stepsize adaptation.">setAdaptMaxLeapfrog</a>(100);
    fisherLogRegBundle.<a name="a55"></a><a class="code" href="classchain_bundle.html#a905a02bac8c26e688448feadd1e5eda2">initAdaptation</a>();
    fisherLogRegBundle.<a name="a56"></a><a class="code" href="classchain_bundle.html#aab7aca03b4e6281d15a7b352b2cb2255" title="Engage dual-averaging stepsize adaptation.">engageAdaptation</a>();
    
    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 0; i &lt; nBurn; ++i) 
    {
        <span class="keywordflow">if</span>(i % 10 == 0) cout &lt;&lt; <span class="stringliteral">&quot;.&quot;</span> &lt;&lt; flush;
        fisherLogRegBundle.<a name="a57"></a><a class="code" href="classchain_bundle.html#afcb8998fd1403bd9098995d478bf3818" title="Transition all chains currently in the bundle.">transition</a>(0);
    }
    cout &lt;&lt; endl;
    
    cout &lt;&lt; <span class="stringliteral">&quot;Accept probability after burn = &quot;</span> &lt;&lt; fisherLogRegBundle.<a class="code" href="classchain_bundle.html#a116c4299238c3a17a82e24217225a1df" title="Return pointer to ith chain.">chain</a>(0)-&gt;<a class="code" href="classbase_hamiltonian.html#ad42f44cca58f1b25ee6fd8ff68c79c57" title="Metropolis accept rate over the history of the chains.">acceptRate</a>() &lt;&lt; endl;
    cout &lt;&lt; <span class="stringliteral">&quot;Stepsize = &quot;</span> &lt;&lt; fisherLogRegBundle.<a name="a58"></a><a class="code" href="classchain_bundle.html#a78103c7106191e7764763e5eef6d8f40" title="Return current stepsize.">stepSize</a>() &lt;&lt; <span class="stringliteral">&quot;, nLeapfrog = &quot;</span> &lt;&lt; fisherLogRegBundle.<a name="a59"></a><a class="code" href="classchain_bundle.html#a54f9f8c8f2ef2b989f190f7fe995e37b" title="Return current number of leapfrog steps.">nLeapfrog</a>() &lt;&lt; endl;
    
    fisherLogRegBundle.<a name="a60"></a><a class="code" href="classchain_bundle.html#adeeb43f183d04c955ce1f1b496a32497" title="Disengage dual-averaging stepsize adaptation.">disengageAdaptation</a>();
    fisherLogRegBundle.<a name="a61"></a><a class="code" href="classchain_bundle.html#ae88d42fe20e5092cce162773bb1a4070" title="Clear all stored samples.">clearSamples</a>();
    
    start = clock();
    
    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 0; i &lt; nSample; ++i) 
    {
        <span class="keywordflow">if</span>(i % 100 == 0) cout &lt;&lt; <span class="stringliteral">&quot;.&quot;</span> &lt;&lt; flush;
        fisherLogRegBundle.<a class="code" href="classchain_bundle.html#afcb8998fd1403bd9098995d478bf3818" title="Transition all chains currently in the bundle.">transition</a>(0);
    }
    cout &lt;&lt; endl;
    
    end = clock();
    
    deltaT = (double)(end - start) / CLOCKS_PER_SEC;
    
    cout &lt;&lt; <span class="stringliteral">&quot;Accept probability after sampling = &quot;</span> &lt;&lt; fisherLogRegBundle.<a class="code" href="classchain_bundle.html#a116c4299238c3a17a82e24217225a1df" title="Return pointer to ith chain.">chain</a>(0)-&gt;<a class="code" href="classbase_hamiltonian.html#ad42f44cca58f1b25ee6fd8ff68c79c57" title="Metropolis accept rate over the history of the chains.">acceptRate</a>() &lt;&lt; endl;
    
    stats.open(<span class="stringliteral">&quot;fisherLogRegStats.txt&quot;</span>);
    fisherLogRegBundle.<a name="a62"></a><a class="code" href="classchain_bundle.html#aa828a38cc56f0cc47f6fbd177be5ee2a">computeSummaryStats</a>(1, <span class="keyword">false</span>, &amp;stats);
    stats.close();
    
    cout &lt;&lt; <span class="stringliteral">&quot;Fisher-Rao Logistic Regression:&quot;</span> &lt;&lt; endl;
    cout &lt;&lt; <span class="stringliteral">&quot;\tDeltaT = &quot;</span> &lt;&lt; deltaT &lt;&lt; <span class="stringliteral">&quot; seconds&quot;</span> &lt;&lt; endl;
    cout &lt;&lt; <span class="stringliteral">&quot;\tminESS = &quot;</span> &lt;&lt; fisherLogRegBundle.<a name="a63"></a><a class="code" href="classchain_bundle.html#ad64d47d0f4803ce73c4ef52c5732b050" title="Return the smallest effective sample size.">minESS</a>() &lt;&lt; endl;
    cout &lt;&lt; <span class="stringliteral">&quot;\tminESS / DeltaT = &quot;</span> &lt;&lt; fisherLogRegBundle.<a class="code" href="classchain_bundle.html#ad64d47d0f4803ce73c4ef52c5732b050" title="Return the smallest effective sample size.">minESS</a>() / deltaT &lt;&lt; <span class="stringliteral">&quot; s^{-1}&quot;</span> &lt;&lt; endl;
    cout &lt;&lt; endl;
    
    <span class="comment">/************************************************/</span>
    <span class="comment">/*                 Riemannian HMC               */</span>
    <span class="comment">/*            with the SoftAbs Metric           */</span>
    <span class="comment">/************************************************/</span>
    
    cout &lt;&lt; <span class="stringliteral">&quot;Beginning SoftAbs Logistic Regression...&quot;</span> &lt;&lt; endl;
    
    <a class="code" href="classchain_bundle.html">chainBundle&lt;softAbsBayesLogReg&gt;</a> softAbsLogRegBundle(random);
    softAbsLogRegBundle.<a name="a64"></a><a class="code" href="classchain_bundle.html#a4f1f4ce7d120254ea37dcd2009f4f4a7" title="Set reject/accept window size.">setWindowSize</a>(0);
    softAbsLogRegBundle.<a name="a65"></a><a class="code" href="classchain_bundle.html#aab0f4b4d5d5b0a0fd79d7898c3cd187e" title="Set maximum calculated lag.">setMaxLagCalc</a>(nLagCalc);
    softAbsLogRegBundle.<a name="a66"></a><a class="code" href="classchain_bundle.html#ad8dd855dcf3f96e996f7443de4e32ec1" title="Set maximum displayed lag.">setMaxLagDisplay</a>(nLagDisplay);
    
    softAbsLogRegBundle.<a name="a67"></a><a class="code" href="classchain_bundle.html#a01efcad844680e9a5b2c82b135e801e3" title="Add a new chain to the bundle.">addChain</a>(<span class="keyword">new</span> <a name="_a68"></a><a class="code" href="classsoft_abs_bayes_log_reg.html">softAbsBayesLogReg</a>(data, t, alpha));
    
    <a class="code" href="classsoft_abs_bayes_log_reg.html">softAbsBayesLogReg</a>* softAbsChain = (<a class="code" href="classsoft_abs_bayes_log_reg.html">softAbsBayesLogReg</a>*)softAbsLogRegBundle.<a name="a69"></a><a class="code" href="classchain_bundle.html#a116c4299238c3a17a82e24217225a1df" title="Return pointer to ith chain.">chain</a>(0);
    softAbsChain-&gt;<a class="code" href="classsoft_abs_metric.html#a1d59676a1548ad7723aaa6ea0149e652" title="Set the SoftAbs regularization coefficient.">setSoftAbsAlpha</a>(1e6);
    
    softAbsLogRegBundle.<a name="a70"></a><a class="code" href="classchain_bundle.html#a451a3c3df477013de63223ead7137f7b" title="Set stepsize.">setStepSize</a>(1e-2);
    
    softAbsLogRegBundle.<a class="code" href="classchain_bundle.html#a116c4299238c3a17a82e24217225a1df" title="Return pointer to ith chain.">chain</a>(0)-&gt;<a class="code" href="classbase_hamiltonian.html#ac1c8948cf4ae590a10d62e45e5a8a337" title="Return the current position.">q</a>() = initQ;
    softAbsLogRegBundle.<a class="code" href="classchain_bundle.html#a116c4299238c3a17a82e24217225a1df" title="Return pointer to ith chain.">chain</a>(0)-&gt;<a class="code" href="classsoft_abs_metric.html#a4d2530ca42c2984eba797982d26d54b3">sampleP</a>(random);
    softAbsLogRegBundle.<a class="code" href="classchain_bundle.html#a116c4299238c3a17a82e24217225a1df" title="Return pointer to ith chain.">chain</a>(0)-&gt;<a class="code" href="classdynam_metric.html#a3f60a5d4db2b1c1cf0a9f69d503c3e02">prepareEvolution</a>();
    
    softAbsLogRegBundle.<a name="a71"></a><a class="code" href="classchain_bundle.html#a4731dfa8145b244fd43a82a79e87b9c0" title="Set target integration time for stepsize adaptation.">setAdaptIntTime</a>(1.5);
    softAbsLogRegBundle.<a name="a72"></a><a class="code" href="classchain_bundle.html#a363544defaffd2ff9c3ca00d9d8e663d" title="Set target accept rate for stepsize adaptation.">setAdaptTargetAccept</a>(0.95);
    softAbsLogRegBundle.<a name="a73"></a><a class="code" href="classchain_bundle.html#a905a02bac8c26e688448feadd1e5eda2">initAdaptation</a>();
    softAbsLogRegBundle.<a name="a74"></a><a class="code" href="classchain_bundle.html#aab7aca03b4e6281d15a7b352b2cb2255" title="Engage dual-averaging stepsize adaptation.">engageAdaptation</a>();
    
    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 0; i &lt; nBurn; ++i) 
    {
        <span class="keywordflow">if</span>(i % 10 == 0) cout &lt;&lt; <span class="stringliteral">&quot;.&quot;</span> &lt;&lt; flush;
        softAbsLogRegBundle.<a name="a75"></a><a class="code" href="classchain_bundle.html#afcb8998fd1403bd9098995d478bf3818" title="Transition all chains currently in the bundle.">transition</a>(0);
    }
    cout &lt;&lt; endl;
    
    cout &lt;&lt; <span class="stringliteral">&quot;Accept probability after burn = &quot;</span> &lt;&lt; softAbsLogRegBundle.<a class="code" href="classchain_bundle.html#a116c4299238c3a17a82e24217225a1df" title="Return pointer to ith chain.">chain</a>(0)-&gt;<a class="code" href="classbase_hamiltonian.html#ad42f44cca58f1b25ee6fd8ff68c79c57" title="Metropolis accept rate over the history of the chains.">acceptRate</a>() &lt;&lt; endl;
    cout &lt;&lt; <span class="stringliteral">&quot;Stepsize = &quot;</span> &lt;&lt; softAbsLogRegBundle.<a name="a76"></a><a class="code" href="classchain_bundle.html#a78103c7106191e7764763e5eef6d8f40" title="Return current stepsize.">stepSize</a>() &lt;&lt; <span class="stringliteral">&quot;, nLeapfrog = &quot;</span> &lt;&lt; softAbsLogRegBundle.<a name="a77"></a><a class="code" href="classchain_bundle.html#a54f9f8c8f2ef2b989f190f7fe995e37b" title="Return current number of leapfrog steps.">nLeapfrog</a>() &lt;&lt; endl;
    
    softAbsLogRegBundle.<a name="a78"></a><a class="code" href="classchain_bundle.html#adeeb43f183d04c955ce1f1b496a32497" title="Disengage dual-averaging stepsize adaptation.">disengageAdaptation</a>();
    softAbsLogRegBundle.<a name="a79"></a><a class="code" href="classchain_bundle.html#ae88d42fe20e5092cce162773bb1a4070" title="Clear all stored samples.">clearSamples</a>();
    
    start = clock();
    
    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 0; i &lt; nSample; ++i) 
    {
        <span class="keywordflow">if</span>(i % 100 == 0) cout &lt;&lt; <span class="stringliteral">&quot;.&quot;</span> &lt;&lt; flush;
        softAbsLogRegBundle.<a class="code" href="classchain_bundle.html#afcb8998fd1403bd9098995d478bf3818" title="Transition all chains currently in the bundle.">transition</a>(0);
    }
    cout &lt;&lt; endl;
    
    end = clock();
    
    deltaT = (double)(end - start) / CLOCKS_PER_SEC;
    
    cout &lt;&lt; <span class="stringliteral">&quot;Accept probability after sampling = &quot;</span> &lt;&lt; softAbsLogRegBundle.<a class="code" href="classchain_bundle.html#a116c4299238c3a17a82e24217225a1df" title="Return pointer to ith chain.">chain</a>(0)-&gt;<a class="code" href="classbase_hamiltonian.html#ad42f44cca58f1b25ee6fd8ff68c79c57" title="Metropolis accept rate over the history of the chains.">acceptRate</a>() &lt;&lt; endl;
    
    stats.open(<span class="stringliteral">&quot;softAbsLogRegStats.txt&quot;</span>);
    softAbsLogRegBundle.<a name="a80"></a><a class="code" href="classchain_bundle.html#aa828a38cc56f0cc47f6fbd177be5ee2a">computeSummaryStats</a>(1, <span class="keyword">false</span>, &amp;stats);
    stats.close();
    
    cout &lt;&lt; <span class="stringliteral">&quot;softAbs Logistic Regression:&quot;</span> &lt;&lt; endl;
    cout &lt;&lt; <span class="stringliteral">&quot;\tDeltaT = &quot;</span> &lt;&lt; deltaT &lt;&lt; <span class="stringliteral">&quot; seconds&quot;</span> &lt;&lt; endl;
    cout &lt;&lt; <span class="stringliteral">&quot;\tminESS = &quot;</span> &lt;&lt; softAbsLogRegBundle.<a name="a81"></a><a class="code" href="classchain_bundle.html#ad64d47d0f4803ce73c4ef52c5732b050" title="Return the smallest effective sample size.">minESS</a>() &lt;&lt; endl;
    cout &lt;&lt; <span class="stringliteral">&quot;\tminESS / DeltaT = &quot;</span> &lt;&lt; softAbsLogRegBundle.<a class="code" href="classchain_bundle.html#ad64d47d0f4803ce73c4ef52c5732b050" title="Return the smallest effective sample size.">minESS</a>() / deltaT &lt;&lt; <span class="stringliteral">&quot; s^{-1}&quot;</span> &lt;&lt; endl;
    cout &lt;&lt; endl;
    
    <span class="keywordflow">return</span> 0;
    
}
</pre></div> </div>
</div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Variables</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<hr class="footer"/><address class="footer"><small>Generated on Tue Dec 18 2012 12:00:18 by&#160;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.4 </small></address>
</body>
</html>
